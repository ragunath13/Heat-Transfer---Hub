<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Re-radiating Surfaces</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Audiowide|Rajdhani|Courier+New">
    <style>
        /* Base styles: Ensuring a deep, consistent black background */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box; /* Includes padding and border in the element's total width and height */
            /* Default background for elements unless specified - slightly off-black for depth */
            background-color: #0a0a0a;
        }

        body {
            background-color: #000000; /* Pure black for the main page background */
            font-family: 'Audiowide', cursive; /* Keeping the distinct, futuristic font */
            color: #d3d3d3; /* A standard light grey for excellent readability on dark backgrounds */
            line-height: 1.6; /* Improves readability of text blocks */
            overflow-x: hidden; /* Prevent horizontal scroll on some subtle effects */
        }

        /* Main Heading: Bold and energetic, central to the radiation theme */
        .main_heading {
            background: linear-gradient(to right, #f40166, #ff2a68, #ff0000); /* Vibrant red/pink/orange gradient */
            font-size: 50px; /* Consistent size for prominence */
            font-family: 'Courier New', monospace; /* A classic techy font */
            font-weight: 900; /* Extra bold for impact */
            color: #000000; /* Black text creates strong contrast on the gradient */
            text-align: center;
            padding: 50px;
            border-radius: 10px;
            box-shadow: 0 0 25px rgba(255, 110, 110, 0.7); /* Stronger, more defined glowing red shadow */
            margin: 30px auto; /* Centers the block and adds vertical spacing */
            max-width: 90%; /* Ensures responsiveness and readability on larger screens */
            will-change: box-shadow; /* Hint to browser for performance optimization */
        }

        /* General Paragraphs: Clean and readable, designed for content */
        p {
            font-size: 22px;
            font-family: 'Audiowide', cursive;
            text-align: center; /* Centered text within paragraphs */
            padding: 20px;
            margin: 25px auto; /* Centers the block and provides vertical spacing */
            max-width: 80%; /* Limits paragraph width for better readability */
            background-color: #1a1a1a; /* Slightly lighter charcoal for subtle visual distinction */
            border-radius: 10px;
            color: #b7b8b8; /* A muted grey for standard text */
            box-shadow: 0 0 8px rgba(255, 42, 104, 0.1); /* Very subtle, understated red glow */
            line-height: 1.7; /* Further improved readability */
        }

        /* Subtopic Headings: Consistent with the main radiation theme's subtopics */
        .subtopics {
            background-image: linear-gradient(58.2deg, rgba(255, 76, 10, 0.9) -3%, rgba(255, 0, 80, 0.8) 49.3%, rgba(255, 200, 0, 0.8) 97.7%); /* Intense, mixed-tone gradient */
            font-size: 28px;
            color: #ffffff;
            font-family: 'Audiowide', cursive;
            font-weight: bold;
            padding: 25px 40px;
            margin: 35px auto; /* Centered with generous spacing */
            max-width: 80%;
            text-align: center;
            border-radius: 15px; /* Softer radius for a less rigid feel */
            border: 2px solid #ff416c; /* A clear, vibrant red border */
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);
            transition: all 0.4s ease; /* All-encompassing smooth transition */
            will-change: transform, box-shadow, background;
            cursor: pointer;
        }

        .subtopics:hover {
            transform: scale(1.03) translateY(-3px); /* More noticeable lift and scale */
            background-image: linear-gradient(58.2deg, rgba(255, 0, 80, 0.95) -3%, rgba(255, 76, 10, 0.95) 49.3%, rgba(255, 200, 0, 0.95) 97.7%); /* Even more intense gradient on hover */
            color: #000000; /* Black text for strong contrast on hover */
            box-shadow: 0 0 45px rgba(255, 0, 80, 0.9); /* Enhanced, stronger glow on hover */
        }

        /* Definition Section: Standard content block with clear typography */
        .def {
            background-color: #111111; /* Consistent dark background */
            font-family: 'Audiowide', cursive;
            font-size: 22px; /* Consistent with general paragraphs */
            color: #b7b8b8;
            font-weight: normal; /* Standard weight for content, avoiding excessive boldness */
            text-align: center;
            padding: 30px;
            margin: 35px auto; /* Centered block with consistent spacing */
            max-width: 80%;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(255, 42, 104, 0.15); /* Subtle red glow */
            line-height: 1.7; /* Improved readability */
        }

        /* Fact Section: Highlighted and impactful, drawing attention with electric energy */
        .fact {
            background-color: #0d0d0d; /* Slightly darker than other blocks for more emphasis */
            font-size: 34px;
            color: #00e0ff; /* A vibrant, electric cyan for a striking highlight */
            font-weight: 900;
            font-family: 'Rajdhani', sans-serif; /* A bold, modern sans-serif */
            text-align: center;
            padding: 40px; /* Generous padding for emphasis */
            margin: 35px auto; /* Centers the block */
            max-width: 85%; /* Ensures good presentation on various screen sizes */
            border-radius: 12px;
            box-shadow: 0 0 35px rgba(0, 224, 255, 0.8); /* Intense, bright cyan glow for "energy" */
            transition: transform 0.3s ease, box-shadow 0.3s ease; /* Smooth interaction on hover */
            will-change: transform, box-shadow; /* Hint to browser for performance optimization */
        }

        .fact:hover {
            transform: scale(1.02); /* Slight scale on hover for a dynamic feel */
            box-shadow: 0 0 50px rgba(0, 224, 255, 1); /* Even brighter, stronger glow on hover */
        }

        /* Tech Points List: Professional styling with custom glowing bullets */
        .tech_points {
            list-style-type: none; /* Removes default bullet points */
            padding: 25px; /* Ample internal spacing */
            margin: 30px auto; /* Centers the block horizontally, adds vertical spacing */
            max-width: 85%; /* Ensures readability on large screens, responsive on small */
            background-color: #1a1a1a; /* A deep charcoal for subtle depth against pure black */
            border-radius: 12px; /* Softly rounded corners for a modern feel */
            box-shadow: 0 0 20px rgba(255, 0, 80, 0.15); /* A subtle, outward glow matching the radiation theme */
            color: #dadada; /* Light grey text for excellent contrast */
            font-family: 'Audiowide', cursive;
            font-size: 20px;
            text-align: left; /* Best for list readability */
            line-height: 1.5; /* Improves text readability */
        }

        .tech_points li {
            padding: 15px 0; /* Vertical padding for each list item */
            border-bottom: 1px solid rgba(255, 255, 255, 0.08); /* A very subtle, transparent line separator */
            position: relative; /* Necessary for positioning the custom bullet point */
            padding-left: 35px; /* Creates space for the custom bullet */
            transition: background-color 0.3s ease, transform 0.2s ease; /* Smooth hover effects */
        }

        .tech_points li:last-child {
            border-bottom: none; /* No separator for the very last item */
        }

        /* Custom glowing bullet point for each list item */
        .tech_points li::before {
            content: ''; /* Required for pseudo-elements */
            position: absolute;
            left: 0; /* Aligns to the left of the padding-left */
            top: 50%;
            transform: translateY(-50%); /* Vertically centers the bullet */
            width: 10px; /* Size of the bullet */
            height: 10px;
            border-radius: 50%; /* Makes it a perfect circle */
            background: linear-gradient(45deg, #00e0ff, #0072ff); /* A cool, vibrant electric cyan gradient */
            box-shadow: 0 0 12px rgba(0, 224, 255, 0.8); /* A strong, matching glow around the bullet */
        }

        .tech_points li:hover {
            background-color: #1a1a1a; /* Slightly lighter black on hover for subtle interaction */
            transform: translateX(5px); /* A subtle slide-right effect on hover */
        }

        /* Re-radiating Surfaces specific visualizations */
        .reradiating-visual-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 40px auto;
            max-width: 90%;
            background: #111111;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 0 20px rgba(0, 198, 255, 0.15); /* Subtle blue glow for visual containers */
            position: relative;
        }

        .three-surface-diagram {
            width: 90%;
            max-width: 700px;
            height: 300px;
            background-color: #0d0d0d;
            border-radius: 10px;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
            border: 1px solid #333;
            display: flex;
            align-items: center;
            justify-content: space-around;
        }

        .radiation-surface {
            width: 150px;
            height: 150px;
            background-color: #333333; /* Default gray */
            border: 2px solid #555;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-family: 'Rajdhani', sans-serif;
            color: #eee;
            font-size: 20px;
            box-shadow: 0 0 10px rgba(255,255,255,0.2);
            position: relative;
            overflow: hidden;
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
        }

        .radiation-surface.reradiating {
            background-color: rgba(100, 100, 100, 0.8); /* Distinct color for reradiating */
            border-color: #ffcc00;
            box-shadow: 0 0 15px rgba(255, 204, 0, 0.7); /* Yellow glow */
        }

        .surface-label {
            position: absolute;
            top: 10px;
            font-size: 24px;
            font-weight: bold;
        }

        .surface-temp-display {
            position: absolute;
            bottom: 10px;
            font-size: 18px;
            color: #ffcc00;
        }

        .radiation-particle {
            position: absolute;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background-color: #ffcc00; /* Yellow for particles */
            opacity: 0.8;
            z-index: 5;
            box-shadow: 0 0 5px #ffcc00;
            animation: particle-flow linear infinite;
        }

        @keyframes particle-flow {
            0% { transform: translate(var(--start-x), var(--start-y)); opacity: 0.8; }
            100% { transform: translate(var(--end-x), var(--end-y)); opacity: 0; }
        }

        .control-panel {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
            width: 90%;
            max-width: 700px;
            padding: 15px;
            background-color: #1a1a1a;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(255, 0, 80, 0.1);
        }

        .control-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #d3d3d3;
            font-family: 'Rajdhani', sans-serif;
            font-size: 18px;
        }

        .control-slider {
            width: 150px;
            -webkit-appearance: none;
            height: 8px;
            background: linear-gradient(to right, #00e0ff, #ffcc00);
            border-radius: 4px;
            outline: none;
            opacity: 0.7;
            transition: opacity .2s;
            margin-top: 5px;
        }

        .control-slider:hover {
            opacity: 1;
        }

        .control-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #ffffff;
            cursor: pointer;
            box-shadow: 0 0 8px rgba(255,255,255,0.8);
        }

        .control-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #ffffff;
            cursor: pointer;
            box-shadow: 0 0 8px rgba(255,255,255,0.8);
        }

        .current-value-display {
            font-family: 'Courier New', monospace;
            font-size: 16px;
            color: #ffcc00;
            margin-top: 5px;
        }

        .result-display {
            font-family: 'Courier New', monospace;
            font-size: 28px;
            color: #00e0ff;
            text-shadow: 0 0 10px #00e0ff;
            margin-top: 20px;
            text-align: center;
        }

        /* Application examples grid */
        .app-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px auto;
            max-width: 90%;
        }

        .app-item {
            background: #1a1a1a; /* Consistent dark background for app items */
            padding: 20px;
            border-radius: 10px;
            transition: transform 0.3s ease, background 0.3s ease, box-shadow 0.3s ease;
            box-shadow: 0 0 10px rgba(0, 198, 255, 0.1); /* Subtle blue glow */
            cursor: pointer;
        }

        .app-item:hover {
            transform: scale(1.03) translateY(-5px); /* Slight lift and scale */
            background: #222222; /* Slightly lighter on hover */
            box-shadow: 0 8px 25px rgba(0, 198, 255, 0.4); /* More pronounced, lifted glow */
        }

        .app-icon {
            font-size: 40px;
            text-align: center;
            margin-bottom: 15px;
            color: #00e0ff; /* Electric cyan for icons */
            text-shadow: 0 0 10px rgba(0, 224, 255, 0.7); /* Glowing icon effect */
        }

        .app-title {
            font-family: 'Rajdhani', sans-serif;
            font-size: 22px;
            color: white;
            margin-bottom: 10px;
            text-align: center;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .main_heading {
                font-size: 40px;
                padding: 30px;
            }
            .subtopics {
                font-size: 22px;
                padding: 12px 20px;
            }
            p, .def {
                font-size: 18px;
                padding: 15px;
                margin: 20px auto;
                max-width: 90%;
            }
            .fact {
                font-size: 28px;
                padding: 30px;
            }
            .tech_points {
                font-size: 18px;
                padding: 20px;
            }
            .tech_points li {
                padding-left: 30px;
            }
            .tech_points li::before {
                width: 8px;
                height: 8px;
            }
            .three-surface-diagram {
                height: 250px;
            }
            .radiation-surface {
                width: 100px;
                height: 100px;
                font-size: 16px;
            }
            .surface-label {
                font-size: 18px;
            }
            .surface-temp-display {
                font-size: 14px;
            }
            .radiation-particle {
                width: 5px;
                height: 5px;
            }
            .control-slider {
                width: 120px;
            }
            .current-value-display {
                font-size: 14px;
            }
            .result-display {
                font-size: 24px;
            }
            .app-grid {
                grid-template-columns: 1fr;
            }
            .app-icon {
                font-size: 36px;
            }
            .app-title {
                font-size: 20px;
            }
        }

        @media (max-width: 480px) {
            .main_heading {
                font-size: 32px;
                padding: 20px;
            }
            .subtopics {
                font-size: 18px;
                padding: 10px 15px;
            }
            p, .def {
                font-size: 16px;
                padding: 12px;
                margin: 15px auto;
            }
            .fact {
                font-size: 24px;
                padding: 25px;
            }
            .tech_points {
                font-size: 16px;
                padding: 15px;
            }
            .tech_points li {
                padding-left: 25px;
            }
            .tech_points li::before {
                width: 6px;
                height: 6px;
            }
            .three-surface-diagram {
                height: 200px;
            }
            .radiation-surface {
                width: 80px;
                height: 80px;
                font-size: 14px;
            }
            .surface-label {
                font-size: 16px;
            }
            .surface-temp-display {
                font-size: 12px;
            }
            .radiation-particle {
                width: 4px;
                height: 4px;
            }
            .control-panel {
                gap: 10px;
                padding: 10px;
            }
            .control-slider {
                width: 100px;
            }
            .current-value-display {
                font-size: 12px;
            }
            .result-display {
                font-size: 20px;
            }
            .app-icon {
                font-size: 32px;
            }
            .app-title {
                font-size: 18px;
            }
        }
    </style>
</head>
<body>

    <div class="main_heading">Re-radiating Surfaces</div>

    <div class="def">
        <p>In radiation heat transfer, a **re-radiating surface** (also known as an adiabatic surface or floating potential surface) is a surface within an enclosure that has no net heat transfer to or from it. This means the total radiation absorbed by the surface equals the total radiation emitted and reflected by it.</p>
        <p>Such surfaces are typically well-insulated and play a crucial role in redistributing radiative energy within a system without acting as a heat source or sink.</p>
    </div>

    <div class="subtopics">Characteristics and Behavior</div>

    <div class="def">
        <ul class="tech_points">
            <li><b>Zero Net Heat Transfer:</b> The defining characteristic is that $Q_{net} = 0$. This implies that the radiosity ($J$) of a reradiating surface is equal to its blackbody emissive power ($E_b$) if it were a blackbody at its own temperature, effectively $J = E_b$.</li>
            <li><b>Temperature Adjustment:</b> The temperature of a reradiating surface is not fixed; it adjusts itself until the energy balance is satisfied (absorbed radiation = emitted radiation).</li>
            <li><b>Diffuse and Gray Assumption:</b> For simplified analysis using radiation networks, reradiating surfaces are typically assumed to be diffuse and gray.</li>
            <li><b>Redistribution of Energy:</b> They act as a medium through which radiation from hotter surfaces is reflected and re-emitted towards colder surfaces, influencing the overall heat transfer paths.</li>
        </ul>
    </div>

    <div class="subtopics">Role in Radiation Networks</div>

    <div class="def">
        <p>In the radiation network analogy, a reradiating surface is represented in a unique way:</p>
        <ul class="tech_points">
            <li>The **surface resistance** of a reradiating surface is still $\frac{1 - \epsilon}{A \epsilon}$.</li>
            <li>However, unlike surfaces with fixed temperatures (where $E_b$ is a known potential), the **$E_b$ node for a reradiating surface is left "floating"** in the network. It is not connected to a fixed potential.</li>
            <li>The condition $Q_{net} = 0$ is applied to the node equation for the reradiating surface's radiosity ($J$) node, allowing its temperature (and thus $E_b$) to be determined as part of the solution.</li>
        </ul>
        <p>This floating $E_b$ node signifies that the surface's temperature is an unknown that will be calculated based on the radiative exchange with other surfaces in the enclosure.</p>
    </div>

    <div class="subtopics">Interactive Visualization: Reradiating Surface</div>

    <div class="reradiating-visual-container">
        <h3>Heat Transfer with a Reradiating Surface</h3>
        <div class="three-surface-diagram" id="radiation-diagram">
            <div class="radiation-surface" id="surface1">
                <span class="surface-label">Hot Surface (S₁)</span>
                <span class="surface-temp-display" id="temp1-display">T₁: 800 K</span>
            </div>
            <div class="radiation-surface reradiating" id="surfaceR">
                <span class="surface-label">Reradiating (Sᵣ)</span>
                <span class="surface-temp-display" id="tempR-display">Tᵣ: Calculating...</span>
            </div>
            <div class="radiation-surface" id="surface2">
                <span class="surface-label">Cold Surface (S₂)</span>
                <span class="surface-temp-display" id="temp2-display">T₂: 300 K</span>
            </div>
        </div>
        <div class="control-panel">
            <div class="control-group">
                <label for="temp1-slider">T₁ (K):</label>
                <input type="range" id="temp1-slider" class="control-slider" min="500" max="1000" value="800">
                <span id="temp1-value" class="current-value-display">800 K</span>
            </div>
            <div class="control-group">
                <label for="emissivity1-slider">$\epsilon_1$:</label>
                <input type="range" id="emissivity1-slider" class="control-slider" min="0.1" max="1.0" step="0.05" value="0.9">
                <span id="emissivity1-value" class="current-value-display">0.90</span>
            </div>
            <div class="control-group">
                <label for="temp2-slider">T₂ (K):</label>
                <input type="range" id="temp2-slider" class="control-slider" min="100" max="500" value="300">
                <span id="temp2-value" class="current-value-display">300 K</span>
            </div>
            <div class="control-group">
                <label for="emissivity2-slider">$\epsilon_2$:</label>
                <input type="range" id="emissivity2-slider" class="control-slider" min="0.1" max="1.0" step="0.05" value="0.9">
                <span id="emissivity2-value" class="current-value-display">0.90</span>
            </div>
            <div class="control-group">
                <label for="emissivityR-slider">$\epsilon_R$:</label>
                <input type="range" id="emissivityR-slider" class="control-slider" min="0.1" max="1.0" step="0.05" value="0.5">
                <span id="emissivityR-value" class="current-value-display">0.50</span>
            </div>
        </div>
        <div class="result-display" id="net-heat-transfer-display">
            Net Heat Transfer (Q₁₂): Calculating...
        </div>
        <p>Observe how the temperature of the reradiating surface (Sᵣ) adjusts itself based on the temperatures and emissivities of the hot (S₁) and cold (S₂) surfaces. The particles illustrate the net heat flow, which passes *through* the reradiating surface, but Sᵣ itself has no net gain or loss.</p>
    </div>

    <div class="fact">
        DID YOU KNOW? Radiation shields, commonly used in cryogenic systems to reduce heat leak, are prime examples of reradiating surfaces. They are designed with low emissivity to minimize radiation transfer!
    </div>

    <div class="subtopics">Implications and Applications</div>

    <div class="def">
        <ul class="tech_points">
            <li><b>Radiation Shields:</b> Crucial for designing effective multi-layer insulation (MLI) in cryogenic storage tanks and spacecraft to block radiative heat transfer.</li>
            <li><b>Furnace Walls:</b> Internal walls of furnaces that are well-insulated often behave as reradiating surfaces, influencing the overall heat distribution.</li>
            <li><b>Building Enclosures:</b> Interior walls or partitions that are not actively heated or cooled can act as reradiating surfaces, impacting radiant comfort.</li>
            <li><b>Thermal Design Optimization:</b> Identifying and properly modeling reradiating surfaces is key to accurate thermal analysis and design of complex systems.</li>
            <li><b>Solar Collectors:</b> Components within solar collectors that are designed to absorb minimal heat but redirect radiation can be considered reradiating.</li>
        </ul>
    </div>

    <div class="app-grid">
        <div class="app-item">
            <div class="app-icon">🧊</div>
            <div class="app-title">Cryogenic Insulation</div>
            <p>Using multiple reradiating shields to minimize heat ingress.</p>
        </div>
        <div class="app-item">
            <div class="app-icon">🔥</div>
            <div class="app-title">Industrial Furnaces</div>
            <p>Walls reradiate heat, affecting workpiece heating uniformity.</p>
        </div>
        <div class="app-item">
            <div class="app-icon">🛰️</div>
            <div class="app-title">Satellite Structures</div>
            <p>Internal components reradiate heat to maintain thermal balance.</p>
        </div>
        <div class="app-item">
            <div class="app-icon">🏡</div>
            <div class="app-title">Radiant Room Heating</div>
            <p>Unheated walls reradiate, contributing to overall comfort.</p>
        </div>
        <div class="app-item">
            <div class="app-icon">🧪</div>
            <div class="app-title">Vacuum Chambers</div>
            <p>Internal surfaces often approximate reradiating behavior.</p>
        </div>
        <div class="app-item">
            <div class="app-icon">💡</div>
            <div class="app-title">Lighting Enclosures</div>
            <p>Reflectors can act as reradiating surfaces, redirecting light.</p>
        </div>
    </div>

    <script>
        // Stefan-Boltzmann constant
        const SIGMA = 5.670e-8; // W/(m^2 * K^4)

        // Get sliders
        const temp1Slider = document.getElementById('temp1-slider');
        const emissivity1Slider = document.getElementById('emissivity1-slider');
        const temp2Slider = document.getElementById('temp2-slider');
        const emissivity2Slider = document.getElementById('emissivity2-slider');
        const emissivityRSlider = document.getElementById('emissivityR-slider');

        // Get display elements
        const temp1Display = document.getElementById('temp1-display');
        const emissivity1ValueDisplay = document.getElementById('emissivity1-value');
        const temp2Display = document.getElementById('temp2-display');
        const emissivity2ValueDisplay = document.getElementById('emissivity2-value');
        const tempRDisplay = document.getElementById('tempR-display');
        const emissivityRValueDisplay = document.getElementById('emissivityR-value');
        const netHeatTransferDisplay = document.getElementById('net-heat-transfer-display');

        // Get surface divs
        const surface1Div = document.getElementById('surface1');
        const surfaceRDiv = document.getElementById('surfaceR');
        const surface2Div = document.getElementById('surface2');
        const radiationDiagram = document.getElementById('radiation-diagram');

        // Initial surface areas (conceptual, in m^2 for calculation)
        // Assume all surfaces have the same area for simplicity in this 1D model
        const A = 1.0; // 1 m^2

        // Animation variables
        let particles = [];
        const maxParticles = 50;

        // Function to update the visualization and calculations
        function updateVisualization() {
            const T1 = parseFloat(temp1Slider.value);
            const epsilon1 = parseFloat(emissivity1Slider.value);
            const T2 = parseFloat(temp2Slider.value);
            const epsilon2 = parseFloat(emissivity2Slider.value);
            const epsilonR = parseFloat(emissivityRSlider.value);

            // Update display values
            temp1Display.textContent = `T₁: ${T1} K`;
            emissivity1ValueDisplay.textContent = epsilon1.toFixed(2);
            temp2Display.textContent = `T₂: ${T2} K`;
            emissivity2ValueDisplay.textContent = epsilon2.toFixed(2);
            emissivityRValueDisplay.textContent = epsilonR.toFixed(2);

            // Update surface colors and glow based on emissivity and temperature
            const minTemp = 100;
            const maxTemp = 1000;

            const applySurfaceStyle = (surfaceDiv, temp, epsilon) => {
                const normalizedTemp = (temp - minTemp) / (maxTemp - minTemp);
                const grayColor = Math.floor(255 * (1 - epsilon));
                surfaceDiv.style.backgroundColor = `rgb(${grayColor}, ${grayColor}, ${grayColor})`;
                const glowIntensity = 10 + normalizedTemp * 40;
                const glowColor = `rgba(255, ${Math.min(255, Math.floor(65 + normalizedTemp * 190))}, ${Math.min(255, Math.floor(108 + normalizedTemp * 147))}, 0.7)`;
                surfaceDiv.style.boxShadow = `0 0 ${glowIntensity}px ${glowColor}`;
            };

            applySurfaceStyle(surface1Div, T1, epsilon1);
            applySurfaceStyle(surface2Div, T2, epsilon2);
            // Reradiating surface has its own distinct color and glow for visual identification
            // Its temperature will be calculated, so we don't use a slider temp for its glow directly
            const grayColorR = Math.floor(255 * (1 - epsilonR));
            surfaceRDiv.style.backgroundColor = `rgba(${grayColorR}, ${grayColorR}, ${grayColorR}, 0.8)`;
            surfaceRDiv.style.borderColor = '#ffcc00'; // Keep yellow border
            surfaceRDiv.style.boxShadow = `0 0 15px rgba(255, 204, 0, 0.7)`; // Keep yellow glow

            // --- Radiation Network Calculation for Three Parallel Plates ---
            // This is a classic problem. We assume parallel plates, so F1R = F2R = 1
            // and F12 = 0 (radiation from 1 is blocked by R, and vice versa).
            // We need to solve for J1, JR, J2.
            // For parallel plates, F_i_to_j = 1 if they are directly facing and block others.
            // Here, F1R = 1, FR1 = 1, FR2 = 1, F2R = 1.
            // The net heat transfer from S1 to S2 *through* the reradiating surface R is:
            // Q12_net = (Eb1 - Eb2) / (R_s1 + R_space_1R + R_sR + R_space_R2 + R_s2)
            // This is a simplified 1D network.

            const Eb1 = SIGMA * Math.pow(T1, 4);
            const Eb2 = SIGMA * Math.pow(T2, 4);

            // Resistances
            const R_s1 = (1 - epsilon1) / (A * epsilon1);
            const R_s2 = (1 - epsilon2) / (A * epsilon2);
            const R_sR = (1 - epsilonR) / (A * epsilonR);

            // Space resistances (assuming F=1 between adjacent parallel plates)
            const R_space_1R = 1 / (A * 1); // F1R = 1
            const R_space_R2 = 1 / (A * 1); // FR2 = 1

            // Total resistance for heat transfer from Eb1 to Eb2 through the reradiating surface
            const Q12_net = (Eb1 - Eb2) / (R_s1 + R_space_1R + R_sR + R_space_R2 + R_s2);

            netHeatTransferDisplay.textContent = `Net Heat Transfer (Q₁₂): ${Q12_net.toFixed(3)} W`;

            // Calculate the temperature of the reradiating surface (Tr)
            // In a network, J_R is the potential at the radiosity node for R.
            // Q_net_R = (Eb_R - J_R) / R_sR = 0  => Eb_R = J_R
            // Also, Q_net_R = (J1 - JR) / R_space_1R + (J2 - JR) / R_space_2R = 0
            // For this simplified case, we can use the formula for two plates with a shield:
            // Q12_net = A * SIGMA * (T1^4 - T2^4) / ( (1/epsilon1) + (1/epsilon2) - 1 + (1/epsilonR) - 1 )
            // This is for black surfaces. For gray surfaces, it's more complex.

            // A common simplification for 2 parallel plates with a reradiating shield:
            // Q_12_with_shield = (Eb1 - Eb2) / ( (1/epsilon1) + (1/epsilonR) - 1 + (1/epsilonR) + (1/epsilon2) - 1 )
            // This is not quite right either.

            // Let's use the exact network solution for J_R, then find T_R from J_R = Eb_R
            // This is a system of 3 equations for J1, JR, J2.
            // For Q_net_R = 0, we have:
            // (J_R - Eb1) / R_s1 + (J_R - J1) / R_space_1R = 0 (Incorrect application of Kirchhoff's current law)
            // The correct way to find J_R is from the current balance at node J_R:
            // (J_R - Eb1) / R_s1 + (J_R - Eb2) / R_s2 = 0 (This is for a direct connection, not through a shield)

            // Let's use the formula for a reradiating shield between two parallel plates:
            // Q_1R = (Eb1 - J_R) / (R_s1 + R_space_1R)
            // Q_R2 = (J_R - Eb2) / (R_sR + R_space_R2)
            // Since Q_1R = Q_R2 (no heat accumulated in R), we can solve for J_R:
            // (Eb1 - J_R) / (R_s1 + R_space_1R) = (J_R - Eb2) / (R_sR + R_space_R2)
            // Let R_total_1R = R_s1 + R_space_1R
            // Let R_total_R2 = R_sR + R_space_R2
            // (Eb1 - J_R) / R_total_1R = (J_R - Eb2) / R_total_R2
            // Eb1 * R_total_R2 - J_R * R_total_R2 = J_R * R_total_1R - Eb2 * R_total_1R
            // Eb1 * R_total_R2 + Eb2 * R_total_1R = J_R * (R_total_1R + R_total_R2)
            // J_R = (Eb1 * R_total_R2 + Eb2 * R_total_1R) / (R_total_1R + R_total_R2)

            const R_total_1R = R_s1 + R_space_1R;
            const R_total_R2 = R_sR + R_space_R2;

            let J_R;
            if (R_total_1R + R_total_R2 === 0) { // Avoid division by zero if all resistances are zero
                J_R = (Eb1 + Eb2) / 2; // Arbitrary, but implies equilibrium
            } else {
                J_R = (Eb1 * R_total_R2 + Eb2 * R_total_1R) / (R_total_1R + R_total_R2);
            }


            // Since Q_net_R = 0, then J_R = Eb_R. So, T_R = (J_R / SIGMA)^(1/4)
            let T_R;
            if (J_R < 0) { // Should not happen for physical radiation, but for safety
                T_R = 0;
            } else {
                T_R = Math.pow(J_R / SIGMA, 0.25);
            }

            tempRDisplay.textContent = `Tᵣ: ${T_R.toFixed(1)} K`;
            applySurfaceStyle(surfaceRDiv, T_R, epsilonR); // Update reradiating surface glow based on calculated T_R

            // Update particle animation (simplified flow from hot to cold, passing through R)
            updateParticles(T1, T_R, T2, Q12_net);
        }

        // Function to manage particle animation (reused from previous immersive)
        function updateParticles(T1, TR, T2, Q12_net) {
            // Clear existing particles
            const existingParticles = document.querySelectorAll('.radiation-particle');
            existingParticles.forEach(p => p.remove());
            particles = [];

            const diagramRect = radiationDiagram.getBoundingClientRect();
            const s1Rect = surface1Div.getBoundingClientRect();
            const sRRect = surfaceRDiv.getBoundingClientRect();
            const s2Rect = surface2Div.getBoundingClientRect();

            // Calculate relative positions within the diagram
            const s1CenterX = (s1Rect.left + s1Rect.width / 2) - diagramRect.left;
            const s1CenterY = (s1Rect.top + s1Rect.height / 2) - diagramRect.top;
            const sRCenterX = (sRRect.left + sRRect.width / 2) - diagramRect.left;
            const sRCenterY = (sRRect.top + sRRect.height / 2) - diagramRect.top;
            const s2CenterX = (s2Rect.left + s2Rect.width / 2) - diagramRect.left;
            const s2CenterY = (s2Rect.top + s2Rect.height / 2) - diagramRect.top;

            let particleCount = Math.min(maxParticles, Math.ceil(Math.abs(Q12_net) * 50)); // Scale by net heat

            if (particleCount < 5 && Math.abs(Q12_net) > 0.001) particleCount = 5; // Ensure some particles for visual

            // Determine flow direction
            const flowDirection = Q12_net > 0 ? 1 : -1; // 1: S1->R->S2, -1: S2->R->S1

            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'radiation-particle';
                radiationDiagram.appendChild(particle);
                particles.push(particle);

                let startX, startY, midX, midY, endX, endY;
                let duration = 2 + Math.random() * 1; // Randomize duration

                if (flowDirection === 1) { // S1 -> R -> S2
                    startX = s1CenterX + (Math.random() - 0.5) * s1Rect.width * 0.8;
                    startY = s1CenterY + (Math.random() - 0.5) * s1Rect.height * 0.8;
                    midX = sRCenterX + (Math.random() - 0.5) * sRRect.width * 0.8;
                    midY = sRCenterY + (Math.random() - 0.5) * sRRect.height * 0.8;
                    endX = s2CenterX + (Math.random() - 0.5) * s2Rect.width * 0.8;
                    endY = s2CenterY + (Math.random() - 0.5) * s2Rect.height * 0.8;
                } else { // S2 -> R -> S1
                    startX = s2CenterX + (Math.random() - 0.5) * s2Rect.width * 0.8;
                    startY = s2CenterY + (Math.random() - 0.5) * s2Rect.height * 0.8;
                    midX = sRCenterX + (Math.random() - 0.5) * sRRect.width * 0.8;
                    midY = sRCenterY + (Math.random() - 0.5) * sRRect.height * 0.8;
                    endX = s1CenterX + (Math.random() - 0.5) * s1Rect.width * 0.8;
                    endY = s1CenterY + (Math.random() - 0.5) * s1Rect.height * 0.8;
                }

                // Create a multi-segment animation for particles
                const keyframes = [
                    { transform: `translate(${startX - s1CenterX}px, ${startY - s1CenterY}px)`, opacity: 0.8 },
                    { transform: `translate(${midX - s1CenterX}px, ${midY - s1CenterY}px)`, opacity: 0.8 },
                    { transform: `translate(${endX - s1CenterX}px, ${endY - s1CenterY}px)`, opacity: 0 }
                ];
                const options = {
                    duration: duration * 1000,
                    iterations: Infinity,
                    easing: 'linear',
                    delay: Math.random() * duration * 1000
                };

                particle.animate(keyframes, options);
            }
        }

        // Event listeners for sliders
        temp1Slider.addEventListener('input', updateVisualization);
        emissivity1Slider.addEventListener('input', updateVisualization);
        temp2Slider.addEventListener('input', updateVisualization);
        emissivity2Slider.addEventListener('input', updateVisualization);
        emissivityRSlider.addEventListener('input', updateVisualization);

        // Initial update on page load
        document.addEventListener('DOMContentLoaded', updateVisualization);
    </script>

</body>
</html>
