<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Metamaterials and Selective Emitters in Thermal Radiation</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Audiowide|Rajdhani|Courier+New">
    <style>
        /* Base styles: Ensuring a deep, consistent black background */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box; /* Includes padding and border in the element's total width and height */
            /* Default background for elements unless specified - slightly off-black for depth */
            background-color: #0a0a0a;
        }

        body {
            background-color: #000000; /* Pure black for the main page background */
            font-family: 'Audiowide', cursive; /* Keeping the distinct, futuristic font */
            color: #d3d3d3; /* A standard light grey for excellent readability on dark backgrounds */
            line-height: 1.6; /* Improves readability of text blocks */
            overflow-x: hidden; /* Prevent horizontal scroll on some subtle effects */
        }

        /* Main Heading: Bold and energetic, central to the radiation theme */
        .main_heading {
            background: linear-gradient(to right, #f40166, #ff2a68, #ff0000); /* Vibrant red/pink/orange gradient */
            font-size: 50px; /* Consistent size for prominence */
            font-family: 'Courier New', monospace; /* A classic techy font */
            font-weight: 900; /* Extra bold for impact */
            color: #000000; /* Black text creates strong contrast on the gradient */
            text-align: center;
            padding: 50px;
            border-radius: 10px;
            box-shadow: 0 0 25px rgba(255, 110, 110, 0.7); /* Stronger, more defined glowing red shadow */
            margin: 30px auto; /* Centers the block and adds vertical spacing */
            max-width: 90%; /* Ensures responsiveness and readability on larger screens */
            will-change: box-shadow; /* Hint to browser for performance optimization */
        }

        /* General Paragraphs: Clean and readable, designed for content */
        p {
            font-size: 22px;
            font-family: 'Audiowide', cursive;
            text-align: center; /* Centered text within paragraphs */
            padding: 20px;
            margin: 25px auto; /* Centers the block and provides vertical spacing */
            max-width: 80%; /* Limits paragraph width for better readability */
            background-color: #1a1a1a; /* Slightly lighter charcoal for subtle visual distinction */
            border-radius: 10px;
            color: #b7b8b8; /* A muted grey for standard text */
            box-shadow: 0 0 8px rgba(255, 42, 104, 0.1); /* Very subtle, understated red glow */
            line-height: 1.7; /* Further improved readability */
        }

        /* Subtopic Headings: Consistent with the main radiation theme's subtopics */
        .subtopics {
            background-image: linear-gradient(58.2deg, rgba(255, 76, 10, 0.9) -3%, rgba(255, 0, 80, 0.8) 49.3%, rgba(255, 200, 0, 0.8) 97.7%); /* Intense, mixed-tone gradient */
            font-size: 28px;
            color: #ffffff;
            font-family: 'Audiowide', cursive;
            font-weight: bold;
            padding: 25px 40px;
            margin: 35px auto; /* Centered with generous spacing */
            max-width: 80%;
            text-align: center;
            border-radius: 15px; /* Softer radius for a less rigid feel */
            border: 2px solid #ff416c; /* A clear, vibrant red border */
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);
            transition: all 0.4s ease; /* All-encompassing smooth transition */
            will-change: transform, box-shadow, background;
            cursor: pointer;
        }

        .subtopics:hover {
            transform: scale(1.03) translateY(-3px); /* More noticeable lift and scale */
            background-image: linear-gradient(58.2deg, rgba(255, 0, 80, 0.95) -3%, rgba(255, 76, 10, 0.95) 49.3%, rgba(255, 200, 0, 0.95) 97.7%); /* Even more intense gradient on hover */
            color: #000000; /* Black text for strong contrast on hover */
            box-shadow: 0 0 45px rgba(255, 0, 80, 0.9); /* Enhanced, stronger glow on hover */
        }

        /* Definition Section: Standard content block with clear typography */
        .def {
            background-color: #111111; /* Consistent dark background */
            font-family: 'Audiowide', cursive;
            font-size: 22px; /* Consistent with general paragraphs */
            color: #b7b8b8;
            font-weight: normal; /* Standard weight for content, avoiding excessive boldness */
            text-align: center;
            padding: 30px;
            margin: 35px auto; /* Centered block with consistent spacing */
            max-width: 80%;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(255, 42, 104, 0.15); /* Subtle red glow */
            line-height: 1.7; /* Improved readability */
        }

        /* Fact Section: Highlighted and impactful, drawing attention with electric energy */
        .fact {
            background-color: #0d0d0d; /* Slightly darker than other blocks for more emphasis */
            font-size: 34px;
            color: #00e0ff; /* A vibrant, electric cyan for a striking highlight */
            font-weight: 900;
            font-family: 'Rajdhani', sans-serif; /* A bold, modern sans-serif */
            text-align: center;
            padding: 40px; /* Generous padding for emphasis */
            margin: 35px auto; /* Centers the block */
            max-width: 85%; /* Ensures good presentation on various screen sizes */
            border-radius: 12px;
            box-shadow: 0 0 35px rgba(0, 224, 255, 0.8); /* Intense, bright cyan glow for "energy" */
            transition: transform 0.3s ease, box-shadow 0.3s ease; /* Smooth interaction on hover */
            will-change: transform, box-shadow; /* Hint to browser for performance optimization */
        }

        .fact:hover {
            transform: scale(1.02); /* Slight scale on hover for a dynamic feel */
            box-shadow: 0 0 50px rgba(0, 224, 255, 1); /* Even brighter, stronger glow on hover */
        }

        /* Tech Points List: Professional styling with custom glowing bullets */
        .tech_points {
            list-style-type: none; /* Removes default bullet points */
            padding: 25px; /* Ample internal spacing */
            margin: 30px auto; /* Centers the block horizontally, adds vertical spacing */
            max-width: 85%; /* Ensures readability on large screens, responsive on small */
            background-color: #1a1a1a; /* A deep charcoal for subtle depth against pure black */
            border-radius: 12px; /* Softly rounded corners for a modern feel */
            box-shadow: 0 0 20px rgba(255, 0, 80, 0.15); /* A subtle, outward glow matching the radiation theme */
            color: #dadada; /* Light grey text for excellent contrast */
            font-family: 'Audiowide', cursive;
            font-size: 20px;
            text-align: left; /* Best for list readability */
            line-height: 1.5; /* Improves text readability */
        }

        .tech_points li {
            padding: 15px 0; /* Vertical padding for each list item */
            border-bottom: 1px solid rgba(255, 255, 255, 0.08); /* A very subtle, transparent line separator */
            position: relative; /* Necessary for positioning the custom bullet point */
            padding-left: 35px; /* Creates space for the custom bullet */
            transition: background-color 0.3s ease, transform 0.2s ease; /* Smooth hover effects */
        }

        .tech_points li:last-child {
            border-bottom: none; /* No separator for the very last item */
        }

        /* Custom glowing bullet point for each list item */
        .tech_points li::before {
            content: ''; /* Required for pseudo-elements */
            position: absolute;
            left: 0; /* Aligns to the left of the padding-left */
            top: 50%;
            transform: translateY(-50%); /* Vertically centers the bullet */
            width: 10px; /* Size of the bullet */
            height: 10px;
            border-radius: 50%; /* Makes it a perfect circle */
            background: linear-gradient(45deg, #00e0ff, #0072ff); /* A cool, vibrant electric cyan gradient */
            box-shadow: 0 0 12px rgba(0, 224, 255, 0.8); /* A strong, matching glow around the bullet */
        }

        .tech_points li:hover {
            background-color: #1a1a1a; /* Slightly lighter black on hover for subtle interaction */
            transform: translateX(5px); /* A subtle slide-right effect on hover */
        }

        /* Metamaterials Visualization Specific Styles */
        .metamaterial-visual-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 40px auto;
            max-width: 90%;
            background: #111111;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 0 20px rgba(255, 42, 104, 0.15); /* Subtle red glow for visual containers */
            position: relative;
        }

        .metamaterial-representation {
            width: 90%;
            max-width: 700px;
            height: 400px;
            background-color: #0d0d0d;
            border-radius: 10px;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
            border: 2px solid #333;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.5); /* Inner shadow for depth */
        }

        #metamaterial-canvas {
            background-color: transparent; /* Canvas background will be drawn by JS */
            display: block;
            width: 100%;
            height: 100%;
        }

        .property-display {
            font-family: 'Courier New', monospace;
            font-size: 24px;
            color: #00e0ff; /* Electric cyan for property display */
            text-shadow: 0 0 10px #00e0ff;
            margin-top: 15px;
            text-align: center;
        }

        .slider-container {
            width: 80%;
            max-width: 500px;
            margin-top: 25px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .property-slider {
            width: 100%;
            -webkit-appearance: none;
            height: 10px;
            background: linear-gradient(to right, #666, #ff416c, #ffcc00); /* Gradient from dark to red to yellow */
            border-radius: 5px;
            outline: none;
            opacity: 0.7;
            transition: opacity .2s;
        }

        .property-slider:hover {
            opacity: 1;
        }

        .property-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: #ffffff;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(255,255,255,0.8);
        }

        .property-slider::-moz-range-thumb {
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: #ffffff;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(255,255,255,0.8);
        }

        /* Application examples grid */
        .app-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px auto;
            max-width: 90%;
        }

        .app-item {
            background: #1a1a1a; /* Consistent dark background for app items */
            padding: 20px;
            border-radius: 10px;
            transition: transform 0.3s ease, background 0.3s ease, box-shadow 0.3s ease;
            box-shadow: 0 0 10px rgba(0, 198, 255, 0.1); /* Subtle blue glow */
            cursor: pointer;
        }

        .app-item:hover {
            transform: scale(1.03) translateY(-5px); /* Slight lift and scale */
            background: #222222; /* Slightly lighter on hover */
            box-shadow: 0 8px 25px rgba(0, 198, 255, 0.4); /* More pronounced, lifted glow */
        }

        .app-icon {
            font-size: 40px;
            text-align: center;
            margin-bottom: 15px;
            color: #00e0ff; /* Electric cyan for icons */
            text-shadow: 0 0 10px rgba(0, 224, 255, 0.7); /* Glowing icon effect */
        }

        .app-title {
            font-family: 'Rajdhani', sans-serif;
            font-size: 22px;
            color: white;
            margin-bottom: 10px;
            text-align: center;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .main_heading {
                font-size: 40px;
                padding: 30px;
            }
            .subtopics {
                font-size: 22px;
                padding: 12px 20px;
            }
            p, .def {
                font-size: 18px;
                padding: 15px;
                margin: 20px auto;
                max-width: 90%;
            }
            .fact {
                font-size: 28px;
                padding: 30px;
            }
            .tech_points {
                font-size: 18px;
                padding: 20px;
            }
            .tech_points li {
                padding-left: 30px;
            }
            .tech_points li::before {
                width: 8px;
                height: 8px;
            }
            .metamaterial-representation {
                height: 320px;
            }
            .property-display {
                font-size: 20px;
            }
            .property-slider {
                height: 8px;
            }
            .property-slider::-webkit-slider-thumb, .property-slider::-moz-range-thumb {
                width: 20px;
                height: 20px;
            }
            .app-grid {
                grid-template-columns: 1fr;
            }
            .app-icon {
                font-size: 36px;
            }
            .app-title {
                font-size: 20px;
            }
        }

        @media (max-width: 480px) {
            .main_heading {
                font-size: 32px;
                padding: 20px;
            }
            .subtopics {
                font-size: 18px;
                padding: 10px 15px;
            }
            p, .def {
                font-size: 16px;
                padding: 12px;
                margin: 15px auto;
            }
            .fact {
                font-size: 24px;
                padding: 25px;
            }
            .tech_points {
                font-size: 16px;
                padding: 15px;
            }
            .tech_points li {
                padding-left: 25px;
            }
            .tech_points li::before {
                width: 6px;
                height: 6px;
            }
            .metamaterial-representation {
                height: 260px;
            }
            .property-display {
                font-size: 18px;
            }
            .property-slider {
                height: 6px;
            }
            .property-slider::-webkit-slider-thumb, .property-slider::-moz-range-thumb {
                width: 18px;
                height: 18px;
            }
            .app-icon {
                font-size: 32px;
            }
            .app-title {
                font-size: 18px;
            }
        }
    </style>
</head>
<body>

    <div class="main_heading">Metamaterials and Selective Emitters in Thermal Radiation</div>

    <div class="def">
        <p><b>Metamaterials</b> are artificially engineered materials designed to possess properties not found in nature, particularly in their interaction with electromagnetic waves. In the context of thermal radiation, metamaterials allow for unprecedented control over emission, absorption, and reflection of light, enabling the creation of <b>selective emitters</b> and absorbers.</p>
        <p>By structuring materials at scales smaller than the wavelength of light, metamaterials can be tailored to emit or absorb radiation very efficiently at specific wavelengths while being transparent or reflective at others. This capability is revolutionizing applications from energy harvesting to thermal camouflage.</p>
    </div>

    <div class="subtopics">Key Principles of Metamaterials and Selective Emitters</div>

    <div class="def">
        <ul class="tech_points">
            <li><b>Sub-Wavelength Structuring:</b> Metamaterials derive their unique properties from their engineered internal structure, rather than their chemical composition. These structures are typically much smaller than the wavelength of the electromagnetic radiation they interact with.</li>
            <li><b>Tailored Radiative Properties:</b> Unlike conventional materials with fixed emissivity and absorptivity, metamaterials can be designed to have highly specific spectral (wavelength-dependent) radiative properties.</li>
            <li><b>Resonance Phenomena:</b> The engineered structures can create resonant interactions with incoming or outgoing photons, leading to enhanced absorption or emission at particular wavelengths.</li>
            <li><b>Near-Field Enhancement:</b> While not exclusive to metamaterials, their precise structuring can further enhance near-field radiative heat transfer across sub-wavelength gaps.</li>
            <li><b>Broadband vs. Narrowband Control:</b> Metamaterials can be designed for either broadband (absorbing/emitting across a wide range) or narrowband (highly selective at a specific wavelength) control.</li>
            <li><b>Directional Control:</b> Beyond spectral control, some metamaterials can also control the direction of emitted or absorbed radiation.</li>
        </ul>
    </div>

    <div class="subtopics">Interactive Tailoring Thermal Emission with Metamaterials</div>

    <div class="metamaterial-visual-container">
        <h3>Metamaterial Surface Emitting Radiation</h3>
        <div class="metamaterial-representation">
            <canvas id="metamaterial-canvas"></canvas>
        </div>
        <div class="property-display" id="surface-temp-display">Surface Temperature: 500 K</div>
        <div class="property-display" id="tuned-wavelength-display">Tuned Wavelength: 10 µm (Infrared)</div>
        <div class="property-display" id="emitted-power-display">Emitted Power: Low</div>
        <div class="slider-container">
            <input type="range" min="300" max="1000" value="500" step="10" class="property-slider" id="temperature-slider">
            <span>Adjust Surface Temperature (K)</span>
        </div>
        <div class="slider-container">
            <input type="range" min="1" max="20" value="10" step="0.5" class="property-slider" id="wavelength-slider">
            <span>Tuned Wavelength (µm)</span>
        </div>
        <p>This simulation shows a metamaterial surface emitting thermal radiation. The color of the emitted "photons" (particles) represents their wavelength. Adjust the "Surface Temperature" to see how the overall emission intensity changes (more particles at higher temperatures). Adjust the "Tuned Wavelength" to observe how the metamaterial preferentially emits photons at that specific wavelength, demonstrating its selective emission capability.</p>
    </div>

    <div class="fact">
        DID YOU KNOW? The first practical application of metamaterials was in cloaking devices, but their potential in thermal management and energy technologies is now far more impactful!
    </div>

    <div class="subtopics">Applications of Metamaterials and Selective Emitters</div>

    <div class="def">
        <ul class="tech_points">
            <li><b>Waste Heat Recovery:</b> Selective emitters can be designed to efficiently radiate heat at specific wavelengths that can be converted into electricity by thermophotovoltaic (TPV) cells, improving energy harvesting efficiency.</li>
            <li><b>Radiative Cooling:</b> Metamaterials can be engineered to emit strongly in the atmospheric transparency window (8-13 µm) while reflecting solar radiation, allowing passive cooling of buildings and devices even under direct sunlight.</li>
            <li><b>Infrared Stealth & Camouflage:</b> By controlling their infrared emission, metamaterials can make objects appear "cold" or blend into the background for thermal imaging systems.</li>
            <li><b>High-Efficiency Solar Absorbers:</b> Designed to absorb nearly all incident solar radiation across the solar spectrum while minimizing thermal re-emission, crucial for solar thermal energy conversion.</li>
            <li><b>Thermal Sensors & Detectors:</b> Enhanced absorption at specific wavelengths can lead to more sensitive and selective infrared detectors.</li>
            <li><b>Optical Filters:</b> Creating highly precise optical filters for various applications, including spectroscopy and telecommunications.</li>
        </ul>
    </div>

    <div class="app-grid">
        <div class="app-item">
            <div class="app-icon">♻️</div>
            <div class="app-title">Waste Heat Recovery</div>
            <p>Converting waste heat to electricity with TPV.</p>
        </div>
        <div class="app-item">
            <div class="app-icon">❄️</div>
            <div class="app-title">Passive Radiative Cooling</div>
            <p>Cooling without energy input, even under sunlight.</p>
        </div>
        <div class="app-item">
            <div class="app-icon">👻</div>
            <div class="app-title">Thermal Camouflage</div>
            <p>Concealing objects from infrared detection.</p>
        </div>
        <div class="app-item">
            <div class="app-icon">☀️</div>
            <div class="app-title">Solar Energy Absorption</div>
            <p>Maximizing solar energy capture for thermal systems.</p>
        </div>
        <div class="app-item">
            <div class="app-icon">🌡️</div>
            <div class="app-title">Advanced Thermal Sensors</div>
            <p>Creating more sensitive and selective infrared detectors.</p>
        </div>
        <div class="app-item">
            <div class="app-icon">🔍</div>
            <div class="app-title">Optical Filtering</div>
            <p>Precise wavelength selection for various applications.</p>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const canvas = document.getElementById('metamaterial-canvas');
            const ctx = canvas.getContext('2d');
            const temperatureSlider = document.getElementById('temperature-slider');
            const wavelengthSlider = document.getElementById('wavelength-slider');
            const surfaceTempDisplay = document.getElementById('surface-temp-display');
            const tunedWavelengthDisplay = document.getElementById('tuned-wavelength-display');
            const emittedPowerDisplay = document.getElementById('emitted-power-display');

            // Simulation parameters
            const surfaceHeight = 50;
            const surfaceColor = '#444444'; // Dark grey surface
            const hotSurfaceColor = 'rgba(255, 100, 0, 0.9)'; // Orange for the hot surface

            const particleRadius = 1.5;
            const particleSpeed = 2;
            const maxParticles = 500;

            let emittedParticles = [];
            let currentTemperature = parseFloat(temperatureSlider.value);
            let tunedWavelength = parseFloat(wavelengthSlider.value);

            const stefanBoltzmannConstant = 5.67e-8; // W/(m^2 K^4)

            // Function to map wavelength (in µm) to an RGB color for visualization
            // This is a simplified representation for visual effect.
            function wavelengthToColor(wavelength) {
                // Approximate visible spectrum: 0.4 µm (violet) to 0.7 µm (red)
                // Infrared: > 0.7 µm
                // UV: < 0.4 µm

                let r = 0, g = 0, b = 0;

                // Scale wavelength to a 0-1 range for a gradient
                // Let's make it more visually distinct for IR
                const scaledWavelength = (wavelength - 1) / 19; // Scale 1-20 µm to 0-1

                if (wavelength < 0.7) { // Visible light (simplified)
                    if (wavelength < 0.45) { // Violet/Blue
                        b = 1; r = 0.5; g = 0.5;
                    } else if (wavelength < 0.55) { // Green
                        g = 1; r = 0.5; b = 0.5;
                    } else if (wavelength < 0.65) { // Yellow/Orange
                        r = 1; g = 0.8; b = 0;
                    } else { // Red
                        r = 1; g = 0.2; b = 0;
                    }
                } else { // Infrared (transition from red to deep red/darker hues)
                    r = 1 - scaledWavelength * 0.5; // Fades red
                    g = 0.2 - scaledWavelength * 0.2; // Fades green
                    b = 0;
                }

                // Add a glowing effect for higher intensity
                const intensity = Math.min(1, Math.pow(currentTemperature / 1000, 2)); // Higher temp, brighter glow
                r = Math.min(255, r * 255 * intensity * 1.5);
                g = Math.min(255, g * 255 * intensity * 1.5);
                b = Math.min(255, b * 255 * intensity * 1.5);

                return `rgba(${Math.round(r)}, ${Math.round(g)}, ${Math.round(b)}, 0.8)`;
            }

            // Function to set canvas dimensions and reset simulation
            const setCanvasDimensions = () => {
                const container = canvas.parentElement;
                canvas.width = container.clientWidth;
                canvas.height = container.clientHeight;
                resetSimulation(); // Reset particles and counters on resize
            };

            function resetSimulation() {
                emittedParticles = [];
                currentTemperature = parseFloat(temperatureSlider.value);
                tunedWavelength = parseFloat(wavelengthSlider.value);
                updateDisplays();
                drawMetamaterialScene(); // Initial draw
            }

            class EmittedParticle {
                constructor(startX, startY, wavelength) {
                    this.x = startX;
                    this.y = startY;
                    const angle = Math.random() * Math.PI * 2; // Emit in all directions
                    this.vx = particleSpeed * Math.cos(angle);
                    this.vy = particleSpeed * Math.sin(angle);
                    this.active = true;
                    this.wavelength = wavelength;
                    this.color = wavelengthToColor(wavelength);
                }

                update() {
                    this.x += this.vx;
                    this.y += this.vy;

                    // Deactivate if leaves canvas
                    if (this.x < 0 || this.x > canvas.width || this.y < 0 || this.y > canvas.height) {
                        this.active = false;
                    }
                }

                draw() {
                    if (this.active) {
                        ctx.fillStyle = this.color;
                        ctx.shadowColor = this.color;
                        ctx.shadowBlur = 5;
                        ctx.beginPath();
                        ctx.arc(this.x, this.y, particleRadius, 0, Math.PI * 2);
                        ctx.fill();
                    }
                }
            }

            function updateSimulation() {
                currentTemperature = parseFloat(temperatureSlider.value);
                tunedWavelength = parseFloat(wavelengthSlider.value);

                // Calculate total emitted power (simplified Stefan-Boltzmann)
                const emittedPower = 0.5 * stefanBoltzmannConstant * Math.pow(currentTemperature, 4); // Simplified area and emissivity

                // Emission rate based on temperature and a boost for tuned wavelength
                const baseEmissionRate = Math.pow(currentTemperature / 300, 2) * 0.5; // Stronger emission at higher temps
                const tunedWavelengthBoost = 5; // How much more likely to emit tuned wavelength

                // Add emitted particles
                if (emittedParticles.length < maxParticles) {
                    const surfaceCenterX = canvas.width / 2;
                    const surfaceCenterY = canvas.height / 2;

                    // Emit a mix of broadband and tuned-wavelength particles
                    let wavelengthToEmit;
                    if (Math.random() < (baseEmissionRate / (baseEmissionRate + tunedWavelengthBoost))) { // Probability of broadband
                        // Broadband emission, random wavelength within a range (e.g., 1-20 µm)
                        wavelengthToEmit = 1 + Math.random() * 19;
                    } else {
                        // Tuned wavelength emission, with some randomness around the tuned value
                        wavelengthToEmit = tunedWavelength + (Math.random() - 0.5) * 2; // +/- 1 µm variation
                        wavelengthToEmit = Math.max(1, Math.min(20, wavelengthToEmit)); // Clamp
                    }

                    // Only add if emission rate allows
                    if (Math.random() < baseEmissionRate) {
                         emittedParticles.push(new EmittedParticle(surfaceCenterX, surfaceCenterY, wavelengthToEmit));
                    }
                }

                // Update and filter particles
                emittedParticles.forEach(p => p.update());
                emittedParticles = emittedParticles.filter(p => p.active);

                updateDisplays();
            }

            function drawMetamaterialScene() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = '#000000'; // Deep space background
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                // Draw metamaterial surface
                const surfaceX = canvas.width / 2 - (canvas.width * 0.7) / 2;
                const surfaceY = canvas.height / 2 - surfaceHeight / 2;
                const surfaceWidth = canvas.width * 0.7;

                ctx.fillStyle = hotSurfaceColor; // Use a constant hot color for the surface itself
                ctx.fillRect(surfaceX, surfaceY, surfaceWidth, surfaceHeight);
                ctx.shadowColor = hotSurfaceColor;
                ctx.shadowBlur = 20;
                ctx.fillRect(surfaceX, surfaceY, surfaceWidth, surfaceHeight); // Redraw for shadow
                ctx.shadowBlur = 0; // Reset shadow

                ctx.font = '20px "Rajdhani", sans-serif';
                ctx.fillStyle = '#ffffff';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText('Metamaterial Surface', canvas.width / 2, surfaceY + surfaceHeight / 2);

                // Draw emitted particles
                emittedParticles.forEach(p => p.draw());

                requestAnimationFrame(drawMetamaterialScene);
                updateSimulation();
            }

            function updateDisplays() {
                surfaceTempDisplay.textContent = `Surface Temperature: ${currentTemperature.toFixed(0)} K`;
                tunedWavelengthDisplay.textContent = `Tuned Wavelength: ${tunedWavelength.toFixed(1)} µm (${tunedWavelength < 0.7 ? 'Visible' : 'Infrared'})`;

                // Simplified emitted power display based on temperature
                const powerLevel = Math.pow(currentTemperature / 1000, 3); // More sensitive to temp change
                let powerText;
                if (powerLevel < 0.1) powerText = 'Very Low';
                else if (powerLevel < 0.3) powerText = 'Low';
                else if (powerLevel < 0.6) powerText = 'Medium';
                else if (powerLevel < 0.9) powerText = 'High';
                else powerText = 'Very High';
                emittedPowerDisplay.textContent = `Emitted Power: ${powerText}`;
            }

            // Event listeners for sliders
            temperatureSlider.addEventListener('input', resetSimulation);
            wavelengthSlider.addEventListener('input', resetSimulation);

            // Initial setup
            setCanvasDimensions();
            window.addEventListener('resize', setCanvasDimensions);
        });
    </script>

</body>
</html>
